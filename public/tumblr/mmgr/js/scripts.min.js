var TumblrPosts=function(a){this.option=$.extend({},this.option),this.config(a),this.$=$(this),this.on(this.EVENT_COMPLETE,$.proxy(this._createTagData,this))};!function(a,b){a.EVENT_COMPLETE="complete",a.EVENT_PROGRESS="progress",a.option={url:"/api/read/json/",restPath:"/api/read/json/",domain:null,maxNum:0},a.$=null,a.offset=0,a.step=50,a.posts=[],a.tags=[],a.config=function(a){return"undefined"==typeof a?this.option:"string"==typeof a?this.option[a]:("[object Object]"===Object.prototype.toString.call(a)&&(b.extend(this.option,a),"domain"in a&&this.config("domain")&&this.config({url:"http://"+this.config("domain")+this.config("restPath")})),this)},a.on=function(){this.$.on.apply(this.$,arguments)},a.bind=a.on,a.off=function(){this.$.off.apply(this.$,arguments)},a.unbind=a.off,a.trigger=function(){this.$.trigger.apply(this.$,arguments)},a.run=function(a){var c,d;if(a){if(!a.posts.length)return void this.trigger(this.EVENT_COMPLETE);for(c=0;c<a.posts.length;c+=1){if(this.posts.length>=this.config("maxNum"))return void this.trigger(this.EVENT_COMPLETE);d=a.posts[c],this.posts.push(d),d.tags&&(this.tags=this.tags.concat(d.tags))}this.offset+=this.step,this.trigger(this.EVENT_PROGRESS)}else this.posts=[],this.tags=[];return b.ajax({url:this.option.url,data:{start:this.offset,num:this.step},dataType:"jsonp",success:b.proxy(this.run,this)}),this},a._createTagData=function(){var a,b,c;for(b={},a=0;a<this.tags.length;a++)c=this.tags[a],b[c]=b[c]?b[c]+1:1;this.tags=[];for(a in b)this.tags.push({name:a,count:b[a]})},a.getPosts=function(a,c){var d=[];return a=a||0,c=c||10,b.each(this.posts,function(b,e){return a>b?void 0:b>=a+c?!1:void d.push(e)}),d},a.getTags=function(a){var b=this.tags;return a&&b.sort(function(b,c){return"asc"===a?b.count-c.count:"desc"===a?c.count-b.count:void 0}),b},a.getTitleByPost=function(a,b){var c=a["regular-title"]||a["photo-caption"]||a["video-caption"]||a["regular-body"]||a.type||"";return c=c.replace(/\<.+?\>/gi,""),c=b?c.substr(0,b):c}}(TumblrPosts.prototype,jQuery),$(document).ready(function(){});