/*
 * jQuery.flickable v1.0b3
 *
 * Copyright (c) 2010 lagos
 * Dual licensed under the MIT and GPL licenses.
 *
 * http://lagoscript.org
 */(function(e,t,n,r){function i(t){return e("script",t).map(function(t,n){var r=e(n).attr("type");return!r||r.toLowerCase()==="text/javascript"?n:null})}var s,o=t.document,u=/iphone|ipod|ipad|android|blackberry/,a=/android/.test(navigator.userAgent.toLowerCase()),f=/^(input|textarea|select|option|button|embed|object)$/,l=RegExp("^(input|textarea|select|option|button|embed|object|a"+(a?"":"|img")+")$");e.fn.flickable=s=function(t){if(typeof t=="string"){var n=Array.prototype.slice.call(arguments,1),i=this;this.each(function(){var s=e.data(this,"flickable"),o=s&&e.isFunction(s[t])?s[t].apply(s,n):s;if(o!==s&&o!==r){i=o;return!1}});return i}return this.each(function(){var n=e.data(this,"flickable");if(n){e.extend(!0,n.options,t);n.init()}else e.data(this,"flickable",new s.prototype.create(t,this))})};s.prototype={options:{cancel:null,disabled:!1,elasticConstant:.16,friction:.96,section:null},canceled:!1,noPadding:!1,layoutStyles:["background-color","background-repeat","background-attachment","background-position","background-image","padding-top","padding-right","padding-bottom","padding-left"],create:function(n,r){var i=this,s=e(r);this.originalElement=s;this.options=e.extend(!0,{},this.options,n);this.layoutStyles=e.extend([],this.layoutStyles);this.client={x:0,y:0};this.inertialVelocity={x:0,y:0};this.remainder={x:0,y:0};this.hasScroll={x:!1,y:!1};this.padding={};this.stretchPosition={};this.sectionPostions=[];this.preventDefaultClick=!1;if(r==t||r==o||/^(html|body)$/i.test(r.nodeName)){if(u.test(navigator.userAgent.toLowerCase()))return;this.box=e(t);this.elementWrapper=e("html");this.element=e("body");this.position=this.positionWindow;this.scroll=this.scrollWindow;this.layoutStyles.push("width");e.each(["top","right","bottom","left"],function(t,n){i.layoutStyles.push(["margin",n].join("-"));e.each(["color","width","style"],function(e,t){i.layoutStyles.push(["border",n,t].join("-"))})})}else this.box=this.elementWrapper=this.element=s;this.init()},init:function(){var n=this,r,s=this.element;if(!this.container){r=i(s).attr("type","text/plain");s.addClass("ui-flickable").append('<div style="clear:both;"/>').wrapInner('<div class="ui-flickable-container"><div class="ui-flickable-wrapper" style="padding:1px;"><div class="ui-flickable-content" style="position:relative;"/></div></div>');r.attr("type","text/javascript");this.container=s.children().bind("touchstart.flickable mousedown.flickable",function(e){return n.dragStart(e)}).bind("click.flickable",function(e){return n.clickHandler(e)});this.wrapper=this.container.children();this.content=this.wrapper.children();this.elementWrapper.bind("touchstart.flickable mousedown.flickable keydown.flickable",function(){n.deactivate()}).bind("touchend.flickable mouseup.flickable mouseleave.flickable keyup.flickable",function(){n.activate()});s.data("style.flickable",s.attr("style"));e.each(this.layoutStyles,function(t,r){var i=s.css(r);n.content.css(r,i);r==="background-color"?n.wrapper.css(r,e.inArray(i,["transparent","rgba(0, 0, 0, 0)"])>=0?"#FFF":i):r==="width"?s.css(r,"auto"):/^(padding-\w+|margin-\w+|border-\w+-width)$/.test(r)?s.css(r,0):/^(background-image|border-\w+-style)$/.test(r)&&s.css(r,"none")});e.nodeName(s[0],"body")?this.box.bind("resize.flickable",function(){setTimeout(function(){!n.options.disabled&&n.refresh()},0)}):s.css("position")==="static"&&s.css("position","relative");e(t).bind("unload.flickable",function(){n.disable()})}this.option(this.options);this.activate()},option:function(t,n){var i=this,s=t;if(arguments.length===0)return e.extend({},this.options);if(typeof t=="string"){if(n===r)return this.options[t];s={};s[t]=n}e.each(s,function(e,t){i.setOption(e,t)});return this},setOption:function(t,n){var i=this,s=!1;this.options[t]=n;switch(t){case"cancel":this.cancel&&this.cancel.removeClass("ui-flickable-canceled").unbind(".flickable");this.cancel=e("div",this.content).map(function(t,n){var r;r=n;r=e(r);r=e.inArray(r.css("overflow"),["scroll","auto"])>=0?r.prop("scrollWidth")>r.attr("clientWidth")||r.prop("scrollHeight")>r.attr("clientHeight"):!1;return r?n:null}).add(e("iframe,textarea,select",this.content));n&&(this.cancel=this.cancel.add(e(n,this.content)));this.cancel.addClass("ui-flickable-canceled").bind("touchstart.flickable mouseenter.flickable",function(){i.canceled=!0}).bind("touchend.flickable mouseleave.flickable",function(){i.canceled=!1});break;case"disabled":this.element[n?"addClass":"removeClass"]("ui-flickable-disabled");n||(this.selected=r);s=!0;this.noPadding=n;break;case"section":this.sections=null;if(n){this.sections=e(n,this.content);s=!0}}s&&this.refresh();return this},destroy:function(){var n;this.noPadding=!0;this.refresh();this.element.attr("style",this.element.data("style.flickable")||null).removeClass("ui-flickable ui-flickable-disabled").removeData("style.flickable");this.elementWrapper.unbind(".flickable");this.box.unbind(".flickable");this.cancel.unbind(".flickable").removeClass("ui-flickable-canceled");e(t).unbind(".flickable");n=i(this.content).attr("type","text/plain");this.content.add(this.wrapper).add(this.container).replaceWith(this.content.children());n.attr("type","text/javascript");this.container=this.content=this.wrapper=this.cancel=this.selected=r;return this},enable:function(){return this.setOption("disabled",!1)},disable:function(){return this.setOption("disabled",!0)},trigger:function(t,n,r){var i=this.options[t];n=e.Event(n);n.type=(t==="flick"?t:"flick"+t).toLowerCase();r=r||{};if(n.originalEvent){t=e.event.props.length;for(var s;t;){s=e.event.props[--t];n[s]=n.originalEvent[s]}}this.originalElement.trigger(n,r);return!(i&&i.call(this.element[0],n,r)===!1||n.isDefaultPrevented())},refresh:function(){var t=this,r={x:0,y:0},i,s,u,a=this.content,f=this.padding,l=e.extend({},f),c=o.compatMode==="CSS1Compat"?this.elementWrapper:this.element,p={};i=a.width();a.width("auto");u=this.elementWrapper.prop("scrollHeight")-(l.height||0)*2;s=this.elementWrapper.prop("scrollWidth")-(l.width||0)*2;if(i>s){a.width(i);s=a.outerWidth()+parseInt(a.css("margin-left"))+parseInt(a.css("margin-right"))}e.each({Height:u,Width:s},function(e,r){var i=e.toLowerCase();p[i]=t.box[i]();f[i]=r>c.attr("client"+e)&&!t.noPadding?n.round(p[i]/2):0});this.container.width(p.width>=s?"auto":s).css({"padding-top":f.height,"padding-bottom":f.height,"padding-left":f.width,"padding-right":f.width});s=p.width>s?p.width:s;this.hasScroll.x=this.elementWrapper.prop("scrollWidth")>c.attr("clientWidth");this.hasScroll.y=this.elementWrapper.prop("scrollHeight")>c.attr("clientHeight");i=this.position(this.wrapper);this.stretchPosition={top:i.top,bottom:i.top+u-c.attr("clientHeight"),left:i.left,right:i.left+s-c.attr("clientWidth")};this.sectionPostions=this.sections?this.sections.map(function(){return t.position(this)}).get():[];e.each({x:"width",y:"height"},function(e,t){r[e]=f[t]-(l[t]||0)});this.scroll(r.x,r.y);return this},scroll:function(e,t){var n=this.box;e&&n.scrollLeft(n.scrollLeft()+e);t&&n.scrollTop(n.scrollTop()+t);return this},scrollWindow:function(e,t){this.box[0].scrollBy(parseInt(e),parseInt(t));return this},position:function(t){t=e(t).offset();var r=this.element.offset();return{top:n.floor(t.top-r.top+this.box.scrollTop()),left:n.floor(t.left-r.left+this.box.scrollLeft())}},positionWindow:function(t){t=e(t).offset();return{top:n.floor(t.top),left:n.floor(t.left)}},activate:function(){this.scrollBack();return this},deactivate:function(){this.isScrolling()&&(this.preventDefaultClick=!0);this.remainder.x=0;this.remainder.y=0;this.inertialVelocity.x=0;this.inertialVelocity.y=0;clearInterval(this.inertia);clearInterval(this.back);return this},clickHandler:function(e){if(this.preventDefaultClick){e.preventDefault();this.preventDefaultClick=!1}},dragStart:function(t){var n=this,r=t.type==="touchstart"?t.originalEvent.touches[0]:t;if(!(t.type==="touchstart"&&t.originalEvent.touches.length>1)&&!this.canceled&&!this.options.disabled){this.timeStamp=t.timeStamp;e.each(["x","y"],function(e,t){n.client[t]=r["client"+t.toUpperCase()];n.inertialVelocity[t]=0});if(this.trigger("dragStart",t)===!1)return!1;this.container.unbind("touchstart.flickable mousedown.flickable").bind("touchmove.flickable mousemove.flickable",function(e){return n.drag(e)}).bind("touchend.flickable mouseup.flickable mouseleave.flickable",function(e){return n.dragStop(e)});(t.type==="touchstart"?l:f).test(t.target.nodeName.toLowerCase())||t.preventDefault()}},drag:function(t){var r=this,i={},s=t.timeStamp-this.timeStamp,o=t.type==="touchmove"?t.originalEvent.touches[0]:t;if(!(t.type==="touchmove"&&t.originalEvent.touches.length>1)){if(this.trigger("drag",t)===!1)return!1;e.each(["x","y"],function(e,t){var n=o["client"+t.toUpperCase()];i[t]=r.hasScroll[t]&&(!r.draggableAxis||r.draggableAxis===t)?r.client[t]-n:0;r.client[t]=n;s&&(r.inertialVelocity[t]=i[t]/s)});if(this.sections&&!this.draggableAxis){this.draggableAxis=n.abs(i.x)>n.abs(i.y)?"x":"y";i[this.draggableAxis==="x"?"y":"x"]=0}this.timeStamp=t.timeStamp;i=this.velocity(i);this.scroll(i.x,i.y);f.test(t.target.nodeName.toLowerCase())||t.preventDefault();this.preventDefaultClick=!0}},dragStop:function(e){var t=this;if(!(e.type==="touchend"&&e.originalEvent.touches.length>1)){if(this.trigger("dragStop",e)===!1)return!1;this.container.unbind(".flickable").bind("touchstart.flickable mousedown.flickable",function(e){return t.dragStart(e)}).bind("click.flickable",function(e){return t.clickHandler(e)});this.flick()}},flick:function(){var t=this,i=this.options,s=this.box,o=this.inertialVelocity,u=i.friction;clearInterval(this.inertia);e.each(o,function(e,t){n.abs(t)<.1&&(o[e]=0)});if(this.sections){var a,f,l;if(this.isScrolling()){var c,p,d,v,m,g=s.scrollTop(),y=s.scrollLeft();if(n.abs(o.x)>n.abs(o.y)){l="x";v="left";m="scrollLeft";d=y;o.y=0}else{l="y";v="top";m="scrollTop";d=g;o.x=0}c=e.map(this.sectionPostions,function(e){return o[l]>0&&e[v]>d||o[l]<0&&e[v]<d?n.abs(e.top-g)+n.abs(e.left-y):Infinity});p=n.min.apply(n,c);if(p!==Infinity){a=this.sectionPostions[e.inArray(p,c)][v];f=a-d;u=!1}}}o.x*=13;o.y*=13;this.inertia=setInterval(function(){if(i.disabled||!t.isScrolling()||t.trigger("flick")===!1){o.x=0;o.y=0;clearInterval(t.inertia);t.scrollBack()}else{if(a!==r){var n=s[m]();o[l]=f>0&&n>a||f<0&&n<a?0:i.elasticConstant/4*f}e.extend(o,t.velocity(o,u));t.scroll(o.x,o.y)}},13);return this},scrollBack:function(){var t=this,i=this.options,s=this.inertialVelocity,o=!1;clearInterval(this.back);this.back=setInterval(function(){if(!(i.disabled||s.x&&s.y)){var u={},a={};if(t.sections){var f,l,p,v=t.box.scrollTop(),m=t.box.scrollLeft();f=e.map(t.sectionPostions,function(e){return n.abs(e.top-v)+n.abs(e.left-m)});l=e.inArray(n.min.apply(n,f),f);f=t.sectionPostions[l];a={x:t.hasScroll.x?m-f.left:0,y:t.hasScroll.y?v-f.top:0};!a.x&&!a.y&&!t.isScrolling()&&(p=t.sections.eq(l))}else a=t.stretch();e.each(s,function(e,t){u[e]=t?0:-1*i.elasticConstant*a[e]});u=t.velocity(u,!1);if(u.x||u.y)o=t.trigger("scrollBack")===!1;if(!a.x&&!a.y||o){if(p){t.draggableAxis=r;if(!t.selected||t.selected[0]!=p[0]){f={newSection:p,oldSection:t.selected};t.selected=e(p[0]);t.trigger("change",null,f)}}clearInterval(t.back)}else t.scroll(u.x,u.y)}},13);return this},select:function(t){var n=this,r=this.box,i=r.scrollLeft(),s=r.scrollTop(),o=this.inertialVelocity,u,a;clearInterval(this.back);clearInterval(this.inertia);u=this.sectionPostions[t];a={x:u.left-i,y:u.top-s};this.inertia=setInterval(function(){e.each({x:"Left",y:"Top"},function(e,t){var i=r["scroll"+t]();t=t.toLowerCase();o[e]=a[e]>0&&i>u[t]||a[e]<0&&i<u[t]?0:n.options.elasticConstant/4*a[e]});if(n.options.disabled||!n.isScrolling()){clearInterval(n.inertia);n.scrollBack()}else{e.extend(o,n.velocity(o,!1));n.scroll(o.x,o.y)}},13);return this},stretch:function(){var t=this,n={x:0,y:0},r=this.stretchPosition;e.each({x:["left","right","Left"],y:["top","bottom","Top"]},function(e,i){var s;if(t.hasScroll[e]){s=t.box["scroll"+i[2]]();s<r[i[0]]?n[e]=s-r[i[0]]:s>r[i[1]]&&(n[e]=s-r[i[1]])}});return n},velocity:function(t,i){var s=this,o={},u={};i!==!1&&(o=this.friction(i));e.each(t,function(e,t){t+=s.remainder[e]||0;o[e]!==r&&(t*=o[e]);u[e]=n.round(t);s.remainder[e]=t-u[e]});return u},friction:function(t){var i=this,s={},o=this.stretch();t===r&&(t=1);e.each({x:"width",y:"height"},function(e,r){s[e]=t;if(o[e]){var u=i.padding[r];s[e]*=(u-n.abs(o[e]))/u}});return s},isScrolling:function(){return this.inertialVelocity.x||this.inertialVelocity.y}};s.prototype.create.prototype=s.prototype})(jQuery,window,Math);